# Dumb JSON API Response Envelope

Dumb JSON API Response Envelope (DJARE) is a very, very simple document format
for wrapping JSON payloads generated by an API, inspired by _Self describing
JSONs_[^1] and _JSON:API_[^2].

The goals are:

* It's easy to see which API produced a document
* It's easy to see which version of an API produced a document
* Errors are first-class citizens
* Transport-agnostic

HTTP headers and the like are outside of scope, as they're a description of the
_transport_ rather than the _payload_.

[^1]: https://docs.snowplowanalytics.com/docs/pipeline-components-and-applications/iglu/common-architecture/self-describing-jsons/
[^2]: https://jsonapi.org

## Synopsis

There are two types of DJARE documents. Those that describe successful API
responses:

```
{
    "meta": {
        "version": "0.0.1",
        "from"   : "bar/baz/whatever"
        "schema" : "https://example.com/schemas/address",
    }
    "data"  : { data conforming to the schema, if you specified one }
}
```

and those that describe errors:

```
{
    "meta": {
        "version"  : "0.0.1",
        "from"     : "bar/baz/whatever"
        "timestamp": "2020-12-09 16:09:53+00:00"
    }
    "error": {
        "title"      : "Upstream failure",
        "code"       : "NOUPSTREAM",
        "detail"     : "Upstream server gave 500 error",
        "id"         : "5a021a6b-199f-43af-8f61-d7497e333e3a",
    }
}
```

**Every document has exactly two top-level members, `meta` and only one of
`data` and `errors`.**

## Examples

* [Success: full, using all attributes](examples/success-full.json)
* [Success: minimal](examples/success-minimal.json)
* [Error: full, using all attributes](examples/error-full.json)
* [Error: minimal](examples/error-minimal.json)

## Top-level members

### `meta`

`version` *required*, [SemVer](https://semver.org); It describes the version of
the API that produced this document

`from` *required*, string; description of where this document came from. Format
is whatever's most useful to your organization, with some ideas on format below

`schema` *optional*, schema identifier; *Iff* it's included, then the contents
of `data` should conform to the schema, if it exists

`timestamp` *optional*, RFC 3339 timestamp;

`trace` *optional*, anything; literally anything else you think you might find
useful, but see discussion below

### `data`

Free-form, but if you've included `meta/schema`, then it should conform to that
schema.

### `error`

An object, with the following members:

`title` *required*, string; short, human-readable summary of the error

`detail` *optional*, string; human-readable explanation specific to _this_
occurrence of the problem. If `title` says there are no upstream servers, then
`detail` might tell you which

`code` *optional*, string; application-specific error code, as a string value.
Some people like to use HTTP error codes, or this might be a canonical version
of `title` that hasn't been localized. This is meant to be matched by a machine
or by grep

`id` *optional*, string; a unique identifier for this particular occurence of
the problem, which can be cross-referenced against other logs

`trace` *optional*, anything; literally anything else you think you might find
useful

## Discussion and Ideas

### Ideas for `meta/from`

* _Self describing JSONs_[^1] has some interesting ideas for its `schema` key
* Or something like `yourorg/api-name/api-method#http-method`
* It'd be useful for this to be both human readable, but also easily filterable
if you end up with a directory of documents

### Single `error`

JSON:API specifies an array of error objects, but how often are these really
being machine parsed in order? Use the primary error, and put anything else
intereting into `trace`.

### Sticking lots of stuff in `meta/trace`

Sometimes it's not straight-forward to decide what's part of an API, what's
part of a transport, what's part of a specific response, and so on. Also I
think being less prescriptive about what people will find useful is better than
being more so.

For this reason, there's a `meta/trace`, into which you can stick whatever you
like, as an escape hatch. For example, I think that _request id_, _pagination_,
_time taken_, and _handling server_ probably don't live in an envelope like
DJARE, but also it might make your life much easier if such a thing existed for
you.

So: I recommend you don't put all of that stuff in `meta/trace`, but the
flexibility is there if it'll make your usage better

## Changes

v0.0.1 - 2021-08-18 - first release
